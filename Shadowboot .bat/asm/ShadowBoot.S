# ============================================================================
.include "macros.S"
# ============================================================================
# ShadowBoot 17711 patches
# ============================================================================
#
# ============================================================================
#    -- HV  17511  PATCHES --
# ============================================================================
#	Disable fcrt.bin
#      (fcrt.bin is neccesary for some slim drives though)
# ============================================================================
	MAKEPATCH 0x2DFF8
0:
	li   %r10,  0
9:
# ============================================================================
	MAKEPATCH 0x2DE00
0:
	li   %r10,  0
9:
# ============================================================================
#	Disable memory protection on devkits
# ============================================================================
	MAKEPATCH 0x11BC
0:
	ba  0x15F0
9:
# ============================================================================
	MAKEPATCH 0x15F0
0:
	li  %r4, 7
	.long 0x7C212078
	.long 0x7C35EBA6
	ba 0x11C0
9:
# ============================================================================
	MAKEPATCH 0x30090
0:
	ori       %r4, %r4, 0x1B0
9:
# ============================================================================
#       Retail XEX2 AES key   
# note: should be static
# ============================================================================
	MAKEPATCH 0xF0
0:
	.long 0x20B185A5
	.long 0x9D28FDC3
	.long 0x40583FBB
	.long 0x0896BF91
9:
# ============================================================================
# 	Enable retail xex decryption
# ============================================================================
	MAKEPATCH 0x29C4C
0:
	b       0x10   #;//skip signature check for retail consoles. (allow patched xex)
9:
	MAKEPATCH 0x29C70
0:
	li      %r4,  0xF0   #;//patch XexAes key to retail one at 0xF0
9:
# ============================================================================
#	HV Flag fixing function
# note: store at empty space
# ============================================================================
	MAKEPATCH 0xB188 
0:
	lhz     %r3, 0x6(%r0)  # load flag byte into r3
	li      %r4, 0x21
	andc    %r3, %r3, %r4 # clear bit
	sth     %r3, 0x6(%r0)      # store new flag
	cmpldi   %r21,  0    # do what we patched
	ba      0x18BC  #CHANGE THIS ADDR TO JUMP BACK
9:
# ============================================================================
#	HV jump to flag fixer
# ============================================================================
	MAKEPATCH 0x18B8 
0:
	ba  0xB188      #(CHANGE THE ADDR TO FLAG FIXING FUNCTIONS ADDR) ^
9:
# ============================================================================
#       HvxSecuity Functions  (sets machine acct flags)
# ============================================================================
	MAKEPATCH 0x6C58 #;//HvxSecurityGetActivated
0:
	li     %r3, 0
	blr
9:
	MAKEPATCH 0x6B98 #;//HvxSecurityGetDetected
0:
	li     %r3, 0
	blr
9:
	MAKEPATCH 0x6BE8 #;//HvxSecuritySetActivated
0:
	li     %r3, 0
	blr
9:
	MAKEPATCH 0x6B00 #;//HvxSecuritySetDetected
0:
	li     %r3, 0
	blr
9:
	MAKEPATCH 0x6CA8 #;//HvxSecuritySetStat
0:
	li     %r3, 0
	blr
9:
	MAKEPATCH 0x6D08
0:
	li  %r3, 0
	blr
9:
	MAKEPATCH 0x6C48
0:
	li  %r3, 0
	blr
9:
# ============================================================================
#  KV check patches - Hvxkeyshmacsha
# ============================================================================
	MAKEPATCH 0x4F2C  # First check on
0:
	nop
9:
# ============================================================================
#	HV Patch Console Seq check
# ============================================================================
	MAKEPATCH 0x7214
0:
	nop  
9:
#============================================================================
#	HV patch jump
# ============================================================================
	MAKEPATCH 0x71B8
0:
	li %r3, 0 
9:

	MAKEPATCH 0x723C
0:
	nop
9:
# ============================================================================
#       Patch XEX flag
# ============================================================================
	MAKEPATCH 0x72F0
0:
	li %r3, 0
9:

	MAKEPATCH 0x76A0
0:
	li %r4, 0x8
	li %r3, 0
9:

#============================================================================
#	HV Patch blow fuses              
# ============================================================================
# 	MAKEPATCH 0xA1C8 
# 0:
# 	li %r3, 1 
# 	blr
# 9:
# 
# ============================================================================
#       DVDAuth2 retail key
# note: should stay constant
# ============================================================================
	MAKEPATCH 0x10d08
0:
	.long 0xD1E3B33A
	.long 0x6C1EF770
	.long 0x5F6DE93B
	.long 0xB6C0DC71
9:
# ============================================================================
#	HvxDvdAuthRecordXControl  Remove signature check
# ============================================================================
	MAKEPATCH 0x26C04 
0:
	li  %r3, 1
9:
# ============================================================================
#	Remove fcrt.bin hash check
# ============================================================================
# 	MAKEPATCH 0x264F0
# 0:
# 	li    %r3, 1
# 9:
# 
# ============================================================================
#       HV DAE 
# ============================================================================
	MAKEPATCH 0x29018
0:
 	li    %r3, 0
9:
# ============================================================================
#	HvxSetImagePageTableEntry memory addr check
# ============================================================================
	MAKEPATCH 0x29E28
0:
	nop
9:
# ============================================================================
#	HvxCreateImageMapping hash check
# ============================================================================
	MAKEPATCH 0x2C804
0:
	b  0x10
9:
# ============================================================================
#	HvxCreateImageMapping HV XEX region check 
# ============================================================================
	MAKEPATCH 0x2C8FC
0:
	nop
9:
# ============================================================================
#	HvxExpansionInstall sig check
# ============================================================================
	MAKEPATCH 0x30BAC
0:
	nop
9:
	MAKEPATCH 0x30BEC
0:
	nop
9:
# ============================================================================
#	HvxExpansionInstall hash check
# ============================================================================
	MAKEPATCH 0x30C2C 
0:
	nop
9:
# ============================================================================
	MAKEPATCH 0x5FF8
0:
	.long 0x48010
9:
# ============================================================================
#
# ============================================================================
	MAKEPATCH 0x60E4
0:
	li	  %r3, 1
9:
# ============================================================================
#
# ============================================================================
	MAKEPATCH 0x29C48
0:
	cmpldi	  	%cr6, %r28, 0
	beq	  		%cr6, 0x6C
	cmpwi	  	%cr6, %r3, 0
	bne	  		%cr6, 0x54
	li	  		%r4, 0xF0
	b	  		0x64
	nop
9:
#
#------------
#=============================================================================
# Kernel patches
#=============================================================================
#------------
#
# ============================================================================
#	Patch XEX Restrictions check
# ============================================================================
	KMAKEPATCH 0x800A2F48
0:
	li     %r3,  1
9:

	KMAKEPATCH 0x800A0FAC
0:
	b   0x18
9:

# ============================================================================
#	XeKeysConsoleSignatureVerification
#       patch flag check  & always return 1
# ============================================================================
	KMAKEPATCH 0x8014C254
0:
	li   %r3, 1
9:
	KMAKEPATCH 0x8014C25C
0:
	li   %r3, 1
9:
#
# ============================================================================
#	XexpLoadDeltaCompressedImage
#       remove hash check
# ============================================================================
#	KMAKEPATCH 0x800A628C
#0:
#	li   %r3, 0x14
#9:
#
# ============================================================================
#	SataCdRomVerifyDVDX2AuthoringSignature
# ============================================================================
#	KMAKEPATCH 0x800C3648
#0:
#	li   %r3, 1
#9:
#
# ============================================================================
#	StfsMapNewBlock hash mismatch
# ============================================================================
#	KMAKEPATCH 0x800E22EC
#0:
#	b    0x34  #patch to unconditional branch
#9:
#
# ============================================================================
#	SvodMapNewBlock hash mismatch 
# ============================================================================
#	KMAKEPATCH 0x80186A50  
#0:
#	b 0x30  #patch to unconditional branch
#9:
# ============================================================================
#	End of Patches
.long 0xFFFFFFFF
# ============================================================================
